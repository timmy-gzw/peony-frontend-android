apply plugin: 'com.android.application'
apply plugin: 'com.huawei.agconnect'
apply plugin: 'com.alibaba.arouter'
apply plugin: 'privacy-sentry-plugin'

def name = 'yisugar'
def appName = "伊糖"

android {
    compileSdkVersion rootProject.ext.android.compileSdkVersion
    buildToolsVersion rootProject.ext.android.buildToolsVersion

    defaultConfig {
        applicationId "com.tftechsz.peony"
        minSdkVersion rootProject.ext.android.minSdkVersion
        targetSdkVersion rootProject.ext.android.targetSdkVersion
        versionCode version_code as int
        versionName version_name
        flavorDimensions "versionCode"
        vectorDrawables.useSupportLibrary = true
        renderscriptTargetApi 25
        renderscriptSupportModeEnabled true
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
        multiDexEnabled true
        javaCompileOptions {
            annotationProcessorOptions {
                arguments = [AROUTER_MODULE_NAME: project.getName()]
            }
        }
        manifestPlaceholders = [UMENG_CHANNEL_VALUE: name,
                                APPLOG_SCHEME      : "rangersapplog.__TBD__".toLowerCase(),
                                app_label          : appName,
                                app_icon           : "@mipmap/ic_launcher",
                                hotfixKey          : "333738527",
                                hotfixSecret       : "0f7d0099aaaa44cbb1e1e9dc6b07943f",
                                hotfixRsa          : "MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCbjTwRJHSKBbZQdeFldPQ+yLfiWvrHA16OeJ0QJdFDq/m8AR47g4PRisPe8ifuPEpUw+URC7r9+V7mjj4vLnyKWMKHnnjA53gOCUnFo7y0JGmfAiQpsZuirkjV8waxvs5YpMrQwvByX4OO8aHbgLW1udoCXmQqL4080PUmp4kFT6VrLTa5Qv0Lo4pRCiBC8FRMFxJ+a+9rr5HhOkC+KAEtWRZuY4XADOTkAUikomK/pCIX0wpefsHkRid9QADJQ7HzkAujUciXtNufyjZ9mMrGV491QT9P+lbF11rMba4+on4VeejuScmMtJblEr4A1hBNkmP/PAp+TK8VuF4Srh9xAgMBAAECggEBAJlwdSsXwdmQjunJjkAtYO05w6IGSs/bc/+n3I7cLxPI5bzdgXwFXBdsAZC/YEIxuMTqw9/PqXHz9fgJoi+adIFn0uRCnyzyZ0u5P8s0m+U68fFHBHMYXsTXlMNvSlA1PojUbbgGQ3ce3sA3fIjw6s3K+dFSWQ4AABtYqCqsIo5YG8W+btvFTiDE367EaE92Msoc/S5sZ8O+cZRVXwyC8aJDYPYedHwC0oWjVLX2OSwg7SKrcFEc1GdUQ+OcjdY5/CvPcP1Lpfm6jggUHKdl1E16z1SFKpiWKHD1Ga048U7ets+NXF1l7xwDjuQFdUaVqN1rB/TlidDm0Ak7GYyFG8ECgYEAyedRvkyrk++zlcL4UgwQ/+WboCsUJM8ZT0/gIWakFXIBQuy8Zl2BdGQJnCfxSGVEvKMvR3awkHkvYnCEN4sat5tR08CLRpRiHQH967vGTcCD9ypuP57tQXTPaT4zoMFqM+UKdKjdDAbx2dKaQtgwBqmZiFUbqvpMHCLj3qPkhTkCgYEAxTqc6ZRWRP92ENKXrAI3+Pmu2IXThBN99+M8hzBBmEJDWCfMrTGH7MMGsUsW6sjU4i8u/WltLP6RPiNa5ldt6FDW5UgvBrK3SwbCpYeIlrGqN8tj+AGcFN9ftbQOzsinOLyP5QIp3cjZCp4uTD+0KkAjRZQACoZrVsTNhnB/4/kCgYB73jXRSVpubT3BIJeWRp7bT/OVZTh7iK8fcIKyGzWJjqLlezXum2lDjegzbHHkF3T/QiJMdq3GRQLkIuGK7gWbJWgjQFpyF7DF2SX+TPpRU03jAp4W3Br08IQbLjUgZ+kPI3KxtbO/oDcaitFnNxjnzX9LG+PYlqzBCkrAmc4mSQKBgDEhxtERWORbV0gdjhcVfmgRmxLpU6XFTU4hV4S96rlJWIlvcLd8bUX314T3FcBrQ00NQAF07/OTfw8hs5VKFmEXMlFvx/c9MhgImRivSMFxhNvdWQwBKqawdqFHN6EfrzidEKOWBGPxks/oU9Q+0lzsGV1N3yzAC6FT6XciM1nRAoGAKN+INHfS5YLcYZ0EKR6Xu33PCnLBX4CsndQEU7BdRgRN8wBoBjJI3i+8L9B/aqfFTgBB5Gk18sCZiMRId8ySdgmmA4tCOCcPwF06/RCYOKlrQK0FJE5HhXM4zpcUg/iicWExtBxQYZbzW1AGfDv7y6uQRFrTNl+/WNWSwGtNk3A=",
                                buglyKey           : "bbbd02a9aa",
        ]

        ndk {
            abiFilters "armeabi-v7a", "arm64-v8a"
        }
        resConfigs("zh","zh-rCN")
    }
    signingConfigs {
        release {
            storeFile file('peony.jks')
            storePassword "cikJayHiow"
            keyAlias "peony"
            keyPassword "Pixiznuf"
        }
        debug {
            storeFile file('peony.jks')
            storePassword "cikJayHiow"
            keyAlias "peony"
            keyPassword "Pixiznuf"
        }
    }
    buildTypes {

        debug {
            zipAlignEnabled true
            // 移除无用的resource文件
            shrinkResources false
            signingConfig signingConfigs.debug
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'

            manifestPlaceholders = [app_icon: "@mipmap/ic_launcher"]
        }

        release {
            zipAlignEnabled true
            // 移除无用的resource文件
            shrinkResources true
            signingConfig signingConfigs.release
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
            debuggable false
            applicationVariants.all { variant ->
                variant.outputs.all {
                    outputFileName = "Peony_V${defaultConfig.versionName}_${defaultConfig.versionCode}.apk"
                }
                variant.mergeAssetsProvider.configure {
                    doLast {
                        delete(fileTree(dir: outputDir,
                                includes: ['model/ai_face_processor.bundle',
                                           'model/ai_gesture.bundle',
                                           'model/ai_hand_processor.bundle',
                                           'model/ai_human_processor.bundle',
                                           'graphics/controller.bundle',
                                           'graphics/fuzzytoonfilter.bundle',
                                           'graphics/fxaa.bundle',
                                           'graphics/face_makeup.bundle',
                                           'graphics/tongue.bundle']))
                    }
                }
            }
        }

    }

    packagingOptions {
        pickFirst 'lib/arm64-v8a/libc++_shared.so'
        //pickFirst 'lib/x86/libc++_shared.so'
        pickFirst 'lib/armeabi-v7a/libc++_shared.so'
    }

    useLibrary 'org.apache.http.legacy'

    buildFeatures {
        dataBinding = true
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    lintOptions {
        disable 'MissingTranslation'
    }

    flavorDimensions "official"
    productFlavors{
        official{
            manifestPlaceholders = [UMENG_CHANNEL_VALUE: "OFFICIAL"]
        }
    }
}


repositories {
    flatDir {
        dirs '../app/libs'
    }
}


configurations {
    all*.exclude group: 'com.google.guava', module: 'listenablefuture'
}

dependencies {
    implementation fileTree(include: ['*.jar'], dir: 'libs')
    if (isModule.toBoolean()) {
        implementation project(':main')
        implementation project(':home')
        implementation project(':moment')
        implementation project(':im')
        implementation project(':mine')
        implementation project(':videotrimmer')
    }

//    debugImplementation 'com.squareup.leakcanary:leakcanary-android:1.6.1'
//    releaseImplementation 'com.squareup.leakcanary:leakcanary-android-no-op:1.6.1'
//    debugImplementation 'com.squareup.leakcanary:leakcanary-support-fragment:1.6.1'
    implementation 'com.jakewharton.timber:timber:5.0.1'
    testImplementation "junit:junit:4.12"
    androidTestImplementation "androidx.test.ext:junit:1.1.3"

}
